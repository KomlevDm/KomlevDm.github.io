"use strict";(self.webpackChunkgame_of_thrones=self.webpackChunkgame_of_thrones||[]).push([[329],{3329:(ci,re,l)=>{l.r(re),l.d(re,{GamePageComponent:()=>J});var Ne=/\s/;var De=/^\s+/;const Ge=function Re(s){return s&&s.slice(0,function ke(s){for(var e=s.length;e--&&Ne.test(s.charAt(e)););return e}(s)+1).replace(De,"")},z=function Be(s){var e=typeof s;return null!=s&&("object"==e||"function"==e)},ne="object"==typeof global&&global&&global.Object===Object&&global;var Fe="object"==typeof self&&self&&self.Object===Object&&self;const ae=ne||Fe||Function("return this")();var we=ae.Symbol,oe=Object.prototype,ze=oe.hasOwnProperty,Xe=oe.toString,N=we?we.toStringTag:void 0;var Ke=Object.prototype.toString;var ce=we?we.toStringTag:void 0;const Z=function Je(s){return null==s?void 0===s?"[object Undefined]":"[object Null]":ce&&ce in Object(s)?function Ze(s){var e=ze.call(s,N),t=s[N];try{s[N]=void 0;var r=!0}catch{}var n=Xe.call(s);return r&&(e?s[N]=t:delete s[N]),n}(s):function Ye(s){return Ke.call(s)}(s)},H=function We(s){return null!=s&&"object"==typeof s};var it=/^[-+]0x[0-9a-f]+$/i,rt=/^0b[01]+$/i,nt=/^0o[0-7]+$/i,at=parseInt;const ct=function ot(s){if("number"==typeof s)return s;if(function tt(s){return"symbol"==typeof s||H(s)&&"[object Symbol]"==Z(s)}(s))return NaN;if(z(s)){var e="function"==typeof s.valueOf?s.valueOf():s;s=z(e)?e+"":e}if("string"!=typeof s)return 0===s?s:+s;s=Ge(s);var t=rt.test(s);return t||nt.test(s)?at(s.slice(2),t?2:8):it.test(s)?NaN:+s},W=function dt(s){return s?1/0===(s=ct(s))||-1/0===s?17976931348623157e292*(s<0?-1:1):s==s?s:0:0===s?s:0},ft=function ut(s,e,t){return s&&s.length?(e=t||void 0===e?1:function lt(s){var e=W(s),t=e%1;return e==e?t?e-t:e:0}(e),function Me(s,e,t){var r=-1,n=s.length;e<0&&(e=-e>n?0:n+e),(t=t>n?n:t)<0&&(t+=n),n=e>t?0:t-e>>>0,e>>>=0;for(var a=Array(n);++r<n;)a[r]=s[r+e];return a}(s,0,e<0?0:e)):[]};var f=l(2722),vt=l(6895),c=l(6929),i=l(4650);function pt(s,e){if(1&s&&(i.TgZ(0,"div",12)(1,"div",13),i._UZ(2,"div",14),i.qZA(),i._UZ(3,"img",15),i.qZA()),2&s){const t=i.oxw();i.xp6(2),i.Udp("transform",t.bossBarTransformCss)}}class V{lives=0;isShieldActivated=!1;isPunchActivated=!1;isLightningActivated=!1;heroName="";hasBoss=!1;bossLifePct=100;score=0;get bossBarTransformCss(){return"translateX("+(this.bossLifePct-100)+"%)"}height=c.z.Y.MIN;static \u0275fac=function(t){return new(t||V)};static \u0275cmp=i.Xpm({type:V,selectors:[["bar"]],hostVars:2,hostBindings:function(t,r){2&t&&i.Udp("height",r.height,"px")},inputs:{lives:"lives",isShieldActivated:"isShieldActivated",isPunchActivated:"isPunchActivated",isLightningActivated:"isLightningActivated",heroName:"heroName",hasBoss:"hasBoss",bossLifePct:"bossLifePct",score:"score"},standalone:!0,features:[i.jDz],decls:19,vars:10,consts:[[1,"side-slot"],[1,"lives"],[1,"ice-and-fire-font"],["src","assets/img/game/artifacts/life.png"],[1,"power"],["src","assets/img/game/artifacts/shield.png"],["src","assets/img/game/artifacts/punch.png"],["src","assets/img/game/artifacts/lightning.png"],[1,"side-slot","right"],["class","boss-life",4,"ngIf"],[1,"score"],["src","assets/img/game/artifacts/coins.png"],[1,"boss-life"],[1,"life"],[1,"bar"],["src","assets/img/game/boss/boss-avatar.png"]],template:function(t,r){1&t&&(i.TgZ(0,"div",0)(1,"div",1)(2,"span",2),i._uU(3),i.qZA(),i._UZ(4,"img",3),i.qZA(),i.TgZ(5,"div",4),i._UZ(6,"img",5),i.qZA(),i.TgZ(7,"div",4),i._UZ(8,"img",6),i.qZA(),i.TgZ(9,"div",4),i._UZ(10,"img",7),i.qZA()(),i.TgZ(11,"div",2),i._uU(12),i.qZA(),i.TgZ(13,"div",8),i.YNc(14,pt,4,2,"div",9),i.TgZ(15,"div",10)(16,"span",2),i._uU(17),i.qZA(),i._UZ(18,"img",11),i.qZA()()),2&t&&(i.xp6(3),i.Oqu(r.lives),i.xp6(2),i.ekj("activated",r.isShieldActivated),i.xp6(2),i.ekj("activated",r.isPunchActivated),i.xp6(2),i.ekj("activated",r.isLightningActivated),i.xp6(3),i.Oqu(r.heroName),i.xp6(2),i.Q6J("ngIf",r.hasBoss),i.xp6(3),i.Oqu(r.score))},dependencies:[vt.O5],styles:["[_nghost-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;padding:0 12px;box-sizing:border-box}.side-slot[_ngcontent-%COMP%]{display:flex;align-items:center;width:400px;gap:24px}.side-slot.right[_ngcontent-%COMP%]{justify-content:flex-end}.lives[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.lives[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:40px}.power[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;filter:grayscale(1);transition:filter .3s linear}.power[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:40px}.power.activated[_ngcontent-%COMP%]{filter:none}.boss-life[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.boss-life[_ngcontent-%COMP%]   .life[_ngcontent-%COMP%]{width:220px;height:24px;overflow:hidden;border:1px solid rgb(255,255,255);border-radius:2px}.boss-life[_ngcontent-%COMP%]   .life[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#c50907;background-image:linear-gradient(0deg,transparent,rgba(0,0,0,.2) 50%,transparent,transparent);transform:translate(0)}.boss-life[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:40px;border:1px solid rgb(255,255,255);border-radius:50%;box-sizing:border-box}.score[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;justify-self:flex-end}.score[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:5px}.score[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:75px}.ice-and-fire-font[_ngcontent-%COMP%]{margin-top:7px}"],changeDetection:0})}var O=l(3903),M=l(4463),ee=l(1354),te=l(4795),v=l(3184),mt=Math.floor,St=Math.random;const le=function At(s,e){return s+mt(St()*(e-s+1))},ge=function Mt(s){return"number"==typeof s&&s>-1&&s%1==0&&s<=9007199254740991},ue=function Lt(s){return null!=s&&ge(s.length)&&!function It(s){if(!z(s))return!1;var e=Z(s);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}(s)};var kt=/^(?:0|[1-9]\d*)$/;const fe=function Pt(s,e){var t=typeof s;return!!(e=e??9007199254740991)&&("number"==t||"symbol"!=t&&kt.test(s))&&s>-1&&s%1==0&&s<e};var Gt=parseFloat,Bt=Math.min,jt=Math.random;const u=function Ft(s,e,t){if(t&&"boolean"!=typeof t&&function Dt(s,e,t){if(!z(t))return!1;var r=typeof e;return!!("number"==r?ue(t)&&fe(e,t.length):"string"==r&&e in t)&&function yt(s,e){return s===e||s!=s&&e!=e}(t[e],s)}(s,e,t)&&(e=t=void 0),void 0===t&&("boolean"==typeof e?(t=e,e=void 0):"boolean"==typeof s&&(t=s,s=void 0)),void 0===s&&void 0===e?(s=0,e=1):(s=W(s),void 0===e?(e=s,s=0):e=W(e)),s>e){var r=s;s=e,e=r}if(t||s%1||e%1){var n=jt();return Bt(s+n*(e-s+Gt("1e-"+((n+"").length-1))),e)}return le(s,e)},ve=function Ut(s){var e=s.length;return e?s[le(0,e-1)]:void 0},Zt=function Xt(s,e){return function wt(s,e){for(var t=-1,r=null==s?0:s.length,n=Array(r);++t<r;)n[t]=e(s[t],t,s);return n}(e,function(t){return s[t]})},pe=function Yt(s){return H(s)&&"[object Arguments]"==Z(s)};var me=Object.prototype,$t=me.hasOwnProperty,Qt=me.propertyIsEnumerable;const Jt=pe(function(){return arguments}())?pe:function(s){return H(s)&&$t.call(s,"callee")&&!Qt.call(s,"callee")},Se=Array.isArray;var Ae="object"==typeof exports&&exports&&!exports.nodeType&&exports,ye=Ae&&"object"==typeof module&&module&&!module.nodeType&&module,Te=ye&&ye.exports===Ae?ae.Buffer:void 0;const ns=(Te?Te.isBuffer:void 0)||function es(){return!1};var h={};h["[object Float32Array]"]=h["[object Float64Array]"]=h["[object Int8Array]"]=h["[object Int16Array]"]=h["[object Int32Array]"]=h["[object Uint8Array]"]=h["[object Uint8ClampedArray]"]=h["[object Uint16Array]"]=h["[object Uint32Array]"]=!0,h["[object Arguments]"]=h["[object Array]"]=h["[object ArrayBuffer]"]=h["[object Boolean]"]=h["[object DataView]"]=h["[object Date]"]=h["[object Error]"]=h["[object Function]"]=h["[object Map]"]=h["[object Number]"]=h["[object Object]"]=h["[object RegExp]"]=h["[object Set]"]=h["[object String]"]=h["[object WeakMap]"]=!1;var be="object"==typeof exports&&exports&&!exports.nodeType&&exports,k=be&&"object"==typeof module&&module&&!module.nodeType&&module,se=k&&k.exports===be&&ne.process,Rs=function(){try{return k&&k.require&&k.require("util").types||se&&se.binding&&se.binding("util")}catch{}}(),_e=Rs&&Rs.isTypedArray;const Bs=_e?function ks(s){return function(e){return s(e)}}(_e):function Ls(s){return H(s)&&ge(s.length)&&!!h[Z(s)]};var Fs=Object.prototype.hasOwnProperty;const ws=function Us(s,e){var t=Se(s),r=!t&&Jt(s),n=!t&&!r&&ns(s),a=!t&&!r&&!n&&Bs(s),o=t||r||n||a,d=o?function Ht(s,e){for(var t=-1,r=Array(s);++t<s;)r[t]=e(t);return r}(s.length,String):[],w=d.length;for(var T in s)(e||Fs.call(s,T))&&(!o||!("length"==T||n&&("offset"==T||"parent"==T)||a&&("buffer"==T||"byteLength"==T||"byteOffset"==T)||fe(T,w)))&&d.push(T);return d};var zs=Object.prototype;const Ks=function Hs(s,e){return function(t){return s(e(t))}}(Object.keys,Object);var $s=Object.prototype.hasOwnProperty;const qs=function Qs(s){if(!function Xs(s){var e=s&&s.constructor;return s===("function"==typeof e&&e.prototype||zs)}(s))return Ks(s);var e=[];for(var t in Object(s))$s.call(s,t)&&"constructor"!=t&&e.push(t);return e},ti=function ei(s){return null==s?[]:Zt(s,function Js(s){return ue(s)?ws(s):qs(s)}(s))},ii=function si(s){return ve(ti(s))},K=function ri(s){return(Se(s)?ve:ii)(s)};var m=l(6284),S=l(1337);const A_GENERATION_TIME_S_MIN=10,A_GENERATION_TIME_S_MAX=15,A_SPEED=S.Q.SPEED+2,A_SCALE_MIN=.23,A_SCALE_MAX=.28,A_SCALE_SPEED=.0015;class L{assetsService;artifacts=new Set;game=null;generationTimeMs=1e3*A_GENERATION_TIME_S_MAX;constructor(e){this.assetsService=e}start(e){this.game=e,this.game.ticker.add(this.render)}ngOnDestroy(){this.game&&(this.game.ticker.remove(this.render),this.artifacts.forEach(e=>e.sprite.destroy()),this.artifacts.clear(),this.game=null,this.generationTimeMs=1e3*A_GENERATION_TIME_S_MAX)}deleteOneAsync(e){setTimeout(()=>{e.sprite.destroyed||e.sprite.destroy(),this.artifacts.delete(e)})}render=e=>{this.artifacts.forEach(t=>{t.sprite.x<-c.z.X.DELTA(t.sprite)?this.deleteOneAsync(t):this.renderOne(e,t)}),this.generationTimeMs<=0?(this.addOne(),this.generationTimeMs=1e3*u(A_GENERATION_TIME_S_MIN,A_GENERATION_TIME_S_MAX)):this.generationTimeMs-=e*v.vB5.shared.deltaMS};addOne(){if(!this.game)return;const[e,t]=K(Object.entries(this.assetsService.artifacts)),r=new v.jyi(t);r.scale.set(A_SCALE_MAX),r.anchor.set(.5);const n=c.z.Y.DELTA(r),a=u(c.z.Y.MIN+n,c.z.HEIGHT-n);r.position.set(c.z.WIDTH+c.z.X.DELTA(r),a);const o={name:e,sprite:r,scaling:1};this.artifacts.add(o),this.game.stage.addChild(o.sprite)}renderOne(e,t){t.sprite.x-=e*A_SPEED,t.sprite.scale.x<=A_SCALE_MIN&&(t.scaling=1),t.sprite.scale.x>=A_SCALE_MAX&&(t.scaling=-1),t.sprite.scale.set(t.sprite.scale.x+t.scaling*A_SCALE_SPEED)}static \u0275fac=function(t){return new(t||L)(i.LFG(m.z))};static \u0275prov=i.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"})}var b=l(4449),Oe=l(5785),Ie=l(1135),ni=l(4004),Y=l(9405);function Ce({sprite:s,delta:e,speed:t,yMotion:r,random:n}){r.canChange?((s.y<=r.min||s.y>=r.max)&&(r.dir*=-1,r.canChange=!1),s.y+=r.dir*e*t):u(n.scope)===n.sample&&(r.canChange=!0)}const p={ATTACK:{MIN_INTERVAL_S:2,MAX_INTERVAL_S:4,SPEED:S.Q.SPEED+8,SCALE:.21,SCALE_SPEED:.015,ROTATION_ANGLE_DEG:7},SPEED:S.Q.SPEED+1,SCORE:{MIN:800,MAX:1e3}};class P{sprite;score=u(p.SCORE.MIN,p.SCORE.MAX);attack;speed;yMotion={min:0,max:c.z.HEIGHT,canChange:!1,dir:1};attackTime=1e3*p.ATTACK.MIN_INTERVAL_S;constructor(e){this.sprite=new v.KgH(e.textures),this.sprite.scale.set(e.scale),this.sprite.anchor.set(.5),this.sprite.animationSpeed=e.animationSpeed,this.sprite.play();const t=c.z.Y.DELTA(this.sprite);this.yMotion.min=c.z.Y.MIN+t,this.yMotion.max=c.z.HEIGHT-t;const r=u(this.yMotion.min,this.yMotion.max);this.sprite.position.set(2*c.z.WIDTH+c.z.X.DELTA(this.sprite),r),this.attack=e.attack,this.speed=e.speed??p.SPEED,this.yMotion.dir=r>c.z.Y.MID?-1:1}render(e){this.xRender(e),this.yRender(e),this.attackRender(e)}xRender(e){this.sprite.x-=e*this.speed}yRender(e){Ce({sprite:this.sprite,delta:e,speed:this.speed,yMotion:this.yMotion,random:{scope:300,sample:50}})}attackRender(e){this.attack&&(this.attackTime<=0?(this.addAttack(),this.attackTime=1e3*u(p.ATTACK.MIN_INTERVAL_S,p.ATTACK.MAX_INTERVAL_S)):this.attackTime-=e*v.vB5.shared.deltaMS)}addAttack(){this.attack&&this.attack.service.addOne({texture:this.attack.texture,x:this.sprite.x-c.z.X.DELTA(this.sprite),y:this.sprite.y,whose:"monster",speed:p.ATTACK.SPEED,rotationAngleDeg:p.ATTACK.ROTATION_ANGLE_DEG,scale:p.ATTACK.SCALE,scaleSpeed:p.ATTACK.SCALE_SPEED})}}class D{assetsService;attacksService;constructor(e,t){this.assetsService=e,this.attacksService=t}create(){return new P({textures:this.assetsService.monsters.blackDragon.animations.self,scale:.58,animationSpeed:.3,attack:{service:this.attacksService,texture:this.assetsService.attacks["attack-6"]}})}static \u0275fac=function(t){return new(t||D)(i.LFG(m.z),i.LFG(b.U))};static \u0275prov=i.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"})}class R{assetsService;attacksService;constructor(e,t){this.assetsService=e,this.attacksService=t}create(){return new P({textures:this.assetsService.monsters.deathAngel.animations.self,scale:.31,animationSpeed:.65,attack:{service:this.attacksService,texture:this.assetsService.attacks["attack-3"]}})}static \u0275fac=function(t){return new(t||R)(i.LFG(m.z),i.LFG(b.U))};static \u0275prov=i.Yz7({token:R,factory:R.\u0275fac,providedIn:"root"})}class G{assetsService;constructor(e){this.assetsService=e}create(){return new P({textures:this.assetsService.monsters.death.animations.self,scale:.29,animationSpeed:.4,speed:S.Q.SPEED+5})}static \u0275fac=function(t){return new(t||G)(i.LFG(m.z))};static \u0275prov=i.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}class B{assetsService;attacksService;constructor(e,t){this.assetsService=e,this.attacksService=t}create(){return new P({textures:this.assetsService.monsters.icePhoenix.animations.self,scale:.41,animationSpeed:.6,attack:{service:this.attacksService,texture:this.assetsService.attacks["attack-4"]}})}static \u0275fac=function(t){return new(t||B)(i.LFG(m.z),i.LFG(b.U))};static \u0275prov=i.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"})}class j{assetsService;attacksService;constructor(e,t){this.assetsService=e,this.attacksService=t}create(){return new P({textures:this.assetsService.monsters.satan.animations.self,scale:.36,animationSpeed:.2,attack:{service:this.attacksService,texture:this.assetsService.attacks["attack-2"]}})}static \u0275fac=function(t){return new(t||j)(i.LFG(m.z),i.LFG(b.U))};static \u0275prov=i.Yz7({token:j,factory:j.\u0275fac,providedIn:"root"})}const E={ATTACK:{MIN_INTERVAL_S:1,MAX_INTERVAL_S:2,SPEED:S.Q.SPEED+10,SCALE:.24,SCALE_SPEED:.02,ROTATION_ANGLE_DEG:10},SPEED:S.Q.SPEED+1};class ai{sprite;score="invulnerable";attack;speed;attackTime=1e3*E.ATTACK.MIN_INTERVAL_S;constructor(e){this.sprite=new v.KgH(e.textures),this.sprite.scale.set(e.scale),this.sprite.anchor.set(.5),this.sprite.animationSpeed=e.animationSpeed,this.sprite.position.set(c.z.WIDTH+c.z.X.DELTA(this.sprite),c.z.Y.MID),this.sprite.play(),this.attack=e.attack,this.speed=e.speed??E.SPEED}render(e){this.xRender(e),this.attackRender(e)}xRender(e){this.sprite.x-=e*this.speed}attackRender(e){this.attack&&(this.attackTime<=0?(this.addAttack(),this.attackTime=1e3*u(E.ATTACK.MIN_INTERVAL_S,E.ATTACK.MAX_INTERVAL_S)):this.attackTime-=e*v.vB5.shared.deltaMS)}addAttack(){this.attack&&this.attack.service.addOne({texture:this.attack.texture,x:this.sprite.x-c.z.X.DELTA(this.sprite),y:this.sprite.y,whose:"monster",speed:E.ATTACK.SPEED,rotationAngleDeg:E.ATTACK.ROTATION_ANGLE_DEG,scale:E.ATTACK.SCALE,scaleSpeed:E.ATTACK.SCALE_SPEED})}}class F{assetsService;attacksService;constructor(e,t){this.assetsService=e,this.attacksService=t}create(){return new ai({textures:this.assetsService.monsters.undeadDragon.animations.self,scale:.8,animationSpeed:.4,attack:{service:this.attacksService,texture:this.assetsService.attacks["attack-5"]}})}static \u0275fac=function(t){return new(t||F)(i.LFG(m.z),i.LFG(b.U))};static \u0275prov=i.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"})}const y_GENERATION_TIME_S_MIN=2,y_GENERATION_TIME_S_MAX=6,y_GENERATION_TIME_S_BOSS=20,y_INVULNERABLE_COUNTER_MIN=4,y_INVULNERABLE_COUNTER_MAX=6;class I{deathAngelService;icePhoenixService;blackDragonService;satanService;deathService;undeadDragonService;monsters=new Set;hasBoss=!1;game=null;generationTimeMs=1e3*y_GENERATION_TIME_S_MIN;invulnerableCounter=y_INVULNERABLE_COUNTER_MAX;invulnerableCounterValue=0;constructor(e,t,r,n,a,o){this.deathAngelService=e,this.icePhoenixService=t,this.blackDragonService=r,this.satanService=n,this.deathService=a,this.undeadDragonService=o}start(e){this.game=e,this.game.ticker.add(this.render)}ngOnDestroy(){this.game&&(this.game.ticker.remove(this.render),this.monsters.forEach(e=>e.sprite.destroy()),this.monsters.clear(),this.hasBoss=!1,this.game=null,this.generationTimeMs=1e3*y_GENERATION_TIME_S_MIN,this.invulnerableCounter=y_INVULNERABLE_COUNTER_MAX,this.invulnerableCounterValue=0)}deleteOneAsync(e){setTimeout(()=>{e.sprite.destroyed||e.sprite.destroy(),this.monsters.delete(e)})}render=e=>{this.game&&(this.monsters.forEach(t=>{t.sprite.x<-c.z.X.DELTA(t.sprite)?this.deleteOneAsync(t):t.render(e)}),this.generationTimeMs<=0?(this.addOne(),this.generationTimeMs=1e3*(this.hasBoss?y_GENERATION_TIME_S_BOSS:u(y_GENERATION_TIME_S_MIN,y_GENERATION_TIME_S_MAX))):this.generationTimeMs-=e*this.game.ticker.deltaMS)};createOne(){return this.invulnerableCounterValue===this.invulnerableCounter?this.createInvulnerableMonster():K([this.deathService,this.deathAngelService,this.icePhoenixService,this.blackDragonService,this.satanService]).create()}addOne(){if(!this.game)return;const e=this.createOne();this.monsters.add(e),this.game.stage.addChild(e.sprite),this.invulnerableCounterValue++}createInvulnerableMonster(){return this.invulnerableCounterValue=0,this.invulnerableCounter=u(y_INVULNERABLE_COUNTER_MIN,y_INVULNERABLE_COUNTER_MAX),K([this.undeadDragonService]).create()}static \u0275fac=function(t){return new(t||I)(i.LFG(R),i.LFG(B),i.LFG(D),i.LFG(j),i.LFG(G),i.LFG(F))};static \u0275prov=i.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"})}const g={LIVES:50,SPEED:{X:1,Y:S.Q.SPEED+5},ATTACK:{MIN_INTERVAL_S:1,MAX_INTERVAL_S:2,SPEED:S.Q.SPEED+10,SCALE:.23,SCALE_SPEED:.018,ROTATION_ANGLE_DEG:12,Y_DELTA:30},PUNCH_MAX_ARC_COEF:1e3,GENERATION_HERO_SCORE:{MIN:1e4,MAX:15e3}};class C{assetsService;heroService;monsterService;attacksService;livesPct$;hasBoss$;sprite=null;set lives(e){this._lives$.next(e)}get lives(){return this._lives$.value}get canUseMnemoShield(){return 2===u(4)}get canUsePunch(){return 5===u(10)}_lives$=new Ie.X(g.LIVES);_hasBoss$=new Ie.X(!1);yMotion={min:0,max:c.z.HEIGHT,canChange:!1,dir:1};game=null;generationHeroScore=g.GENERATION_HERO_SCORE.MAX;attackTime=1e3*g.ATTACK.MIN_INTERVAL_S;get canCreate(){return!this._hasBoss$.value&&this.heroService.score>=this.generationHeroScore}constructor(e,t,r,n){this.assetsService=e,this.heroService=t,this.monsterService=r,this.attacksService=n,this.livesPct$=this._lives$.asObservable().pipe((0,ni.U)(a=>a/g.LIVES*100)),this.hasBoss$=this._hasBoss$.asObservable()}start(e){this.game=e,this.game.ticker.add(this.render),this.generationHeroScore=u(g.GENERATION_HERO_SCORE.MIN,g.GENERATION_HERO_SCORE.MAX)}ngOnDestroy(){this.game&&(this.game.ticker.remove(this.render),this.game=null,this.sprite=null,this.lives=g.LIVES,this._hasBoss$.next(!1))}render=e=>{this.canCreate&&this.create(),this.xRender(e),this.yRender(e),this.attackRender(e)};create(){if(!this.game)return;this.sprite=new v.KgH(this.assetsService.boss.animations.self),this.sprite.scale.set(-.35,.35),this.sprite.anchor.set(.5),this.sprite.animationSpeed=.4,this.sprite.position.set(c.z.X.BOSS.CREATE,c.z.Y.MID),this.sprite.play(),this.game.stage.addChild(this.sprite);const e=c.z.Y.DELTA(this.sprite);this.yMotion.min=c.z.Y.MIN+e,this.yMotion.max=c.z.HEIGHT-e,this.monsterService.hasBoss=!0,this._hasBoss$.next(!0)}xRender(e){this.sprite&&this.sprite.x>c.z.X.BOSS.LIFE-c.z.X.DELTA(this.sprite)&&(this.sprite.x-=e*g.SPEED.X)}yRender(e){this.sprite&&Ce({sprite:this.sprite,delta:e,speed:g.SPEED.Y,yMotion:this.yMotion,random:{scope:50,sample:25}})}attackRender(e){this.attackTime<=0?(this.canUsePunch?this.addPunch():this.addAttack(),this.attackTime=1e3*u(g.ATTACK.MIN_INTERVAL_S,g.ATTACK.MAX_INTERVAL_S)):this.attackTime-=e*v.vB5.shared.deltaMS}addAttack(e){this.sprite&&this.attacksService.addOne({texture:K(this.assetsService.attacks),x:this.sprite.x-c.z.X.DELTA(this.sprite),y:this.sprite.y+g.ATTACK.Y_DELTA,whose:"monster",speed:g.ATTACK.SPEED,rotationAngleDeg:g.ATTACK.ROTATION_ANGLE_DEG,scale:g.ATTACK.SCALE,scaleSpeed:g.ATTACK.SCALE_SPEED,yRender:e})}addPunch(){this.addAttack((e,t)=>{e.y-=t*g.PUNCH_MAX_ARC_COEF/e.x}),this.addAttack((e,t)=>{e.y-=t*g.PUNCH_MAX_ARC_COEF/2/e.x}),this.addAttack(),this.addAttack((e,t)=>{e.y+=t*g.PUNCH_MAX_ARC_COEF/2/e.x}),this.addAttack((e,t)=>{e.y+=t*g.PUNCH_MAX_ARC_COEF/e.x})}static \u0275fac=function(t){return new(t||C)(i.LFG(m.z),i.LFG(Y.e),i.LFG(I),i.LFG(b.U))};static \u0275prov=i.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"})}var x=(()=>{return(s=x||(x={})).Life="life",s.Shield="shield",s.Punch="punch",s.Lightning="lightning",x;var s})();class U{audioService;assetsService;heroService;monstersService;attacksService;artifactsService;bossService;game=null;constructor(e,t,r,n,a,o,d){this.audioService=e,this.assetsService=t,this.heroService=r,this.monstersService=n,this.attacksService=a,this.artifactsService=o,this.bossService=d}start(e){this.game=e,this.game.ticker.add(this.render)}ngOnDestroy(){this.game&&(this.game.ticker.remove(this.render),this.game=null)}render=()=>{this.artifactsRender(),this.heroRender(),this.monstersRender(),this.bossRender()};artifactsRender(){if(!this.heroService.sprite)return;const{left:e,right:t,top:r,bottom:n}=this.heroService.sprite.getBounds();this.artifactsService.artifacts.forEach(a=>{const o=a.sprite.x,d=a.sprite.y;if(o>=e&&o<=t&&d>=r&&d<=n){switch(a.name){case x.Life:this.audioService.getLifeArtifact.replay(),this.heroService.lives+=1;break;case x.Shield:this.audioService.getShieldArtifact.replay(),this.heroService.activateShield();break;case x.Punch:this.audioService.getPunchArtifact.replay(),this.heroService.activatePunch();break;case x.Lightning:this.audioService.getLightningArtifact.replay(),this.heroService.activateLightning()}this.artifactsService.deleteOneAsync(a)}})}monstersRender(){this.attacksService.attacks.forEach(e=>{if("monster"===e.whose)return;const t=e.sprite.x,r=e.sprite.y;this.monstersService.monsters.forEach(n=>{const{left:a,right:o,top:d,bottom:w}=n.sprite.getBounds();t>=a&&t<=o&&r>=d&&r<=w&&("invulnerable"===n.score?(this.audioService.monsterShield.replay(),this.addSmallBang(t,r)):(this.audioService.monsterDeath.replay(),this.addBang(n.sprite.x,n.sprite.y),this.heroService.score+=n.score,this.monstersService.deleteOneAsync(n)),this.attacksService.deleteOneAsync(e))})})}heroRender(){if(!this.heroService.sprite)return;const{left:e,right:t,top:r,bottom:n}=this.heroService.sprite.getBounds();this.attacksService.attacks.forEach(a=>{if("hero"===a.whose)return;const o=a.sprite.x,d=a.sprite.y;o>=e&&o<=t&&d>=r&&d<=n&&(this.heroService.isShieldActivated?(this.audioService.blockShield.replay(),this.addSmallBang(o,d)):(this.audioService.heroDeath.replay(),this.heroService.lives-=1,this.addBang(this.heroService.sprite.x,this.heroService.sprite.y)),this.attacksService.deleteOneAsync(a))}),this.monstersService.monsters.forEach(a=>{const o=a.sprite.x,d=a.sprite.y;o>=e&&o<=t&&d>=r&&d<=n&&(this.heroService.isShieldActivated?(this.audioService.blockShield.replay(),this.addBang(o,d)):(this.audioService.heroDeath.replay(),this.heroService.lives-=1,this.addBang(this.heroService.sprite.x,this.heroService.sprite.y)),this.audioService.monsterDeath.replay(),this.monstersService.deleteOneAsync(a))})}bossRender(){if(!this.bossService.sprite)return;const{left:e,right:t,top:r,bottom:n}=this.bossService.sprite.getBounds();this.attacksService.attacks.forEach(a=>{if("monster"===a.whose)return;const o=a.sprite.x,d=a.sprite.y;o>=e&&o<=t&&d>=r&&d<=n&&(this.bossService.canUseMnemoShield?(this.audioService.monsterShield.replay(),this.addSmallBang(o,d)):(this.audioService.monsterDeath.replay(),this.bossService.lives-=1,this.addBang(this.bossService.sprite.x,this.bossService.sprite.y)),this.attacksService.deleteOneAsync(a))})}addBang(e,t){if(!this.game)return;const r=new v.KgH(this.assetsService.bang.animations.self);r.animationSpeed=.4,r.scale.set(.5),r.angle=90,r.anchor.set(.5),r.position.set(e,t),r.loop=!1,r.onComplete=()=>r.destroy(),r.play(),this.game.stage.addChild(r)}addSmallBang(e,t){if(!this.game)return;const r=new v.KgH(this.assetsService.smallBang.animations.self);r.animationSpeed=.4,r.scale.set(.5),r.anchor.set(.5),r.position.set(e,t),r.loop=!1,r.onComplete=()=>r.destroy(),r.play(),this.game.stage.addChild(r)}static \u0275fac=function(t){return new(t||U)(i.LFG(Oe.Q),i.LFG(m.z),i.LFG(Y.e),i.LFG(I),i.LFG(b.U),i.LFG(L),i.LFG(C))};static \u0275prov=i.Yz7({token:U,factory:U.\u0275fac,providedIn:"root"})}class _{audioService;bgService;heroService;artifactsService;interactionsService;monstersService;attacksService;bossService;host=null;game=null;constructor(e,t,r,n,a,o,d,w){this.audioService=e,this.bgService=t,this.heroService=r,this.artifactsService=n,this.interactionsService=a,this.monstersService=o,this.attacksService=d,this.bossService=w}start(e){this.game||(this.host=e,this.game=new v.MxU({resizeTo:e,resolution:window.devicePixelRatio}),e.appendChild(this.game.view),this.game.stage.cullable=!0,this.bgService.start(this.game),this.artifactsService.start(this.game),this.attacksService.start(this.game),this.heroService.start(this.game),this.monstersService.start(this.game),this.interactionsService.start(this.game),this.bossService.start(this.game),this.audioService.bgAudio.setVolume(0),this.audioService.playGame.play())}restart(){this.host&&(this.destroy(),this.start(this.host))}pause(){this.game&&this.game.stop()}continue(){this.game&&this.game.start()}finish(){this.host&&(this.destroy(),this.host=null,this.audioService.bgAudio.setVolume(1))}destroy(){this.game&&(this.bgService.ngOnDestroy(),this.artifactsService.ngOnDestroy(),this.attacksService.ngOnDestroy(),this.heroService.ngOnDestroy(),this.monstersService.ngOnDestroy(),this.interactionsService.ngOnDestroy(),this.bossService.ngOnDestroy(),this.game.destroy(!0,{children:!0}),this.game=null)}static \u0275fac=function(t){return new(t||_)(i.LFG(Oe.Q),i.LFG(S.Q),i.LFG(Y.e),i.LFG(L),i.LFG(U),i.LFG(I),i.LFG(b.U),i.LFG(C))};static \u0275prov=i.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"})}var ie=l(4843);class $ extends te.G{router;gameService;isDialog=!0;constructor(e,t){super(),this.router=e,this.gameService=t}ngOnInit(){super.ngOnInit(),this.self.afterOpened().pipe((0,f.R)(this.destroyer$)).subscribe(()=>this.gameService.pause()),this.self.beforeClosed().pipe((0,f.R)(this.destroyer$)).subscribe(()=>this.gameService.continue())}finish(){this.audioService.routing.replay(),this.router.navigateByUrl("/menu")}static \u0275fac=function(t){return new(t||$)(i.Y36(ie.F0),i.Y36(_))};static \u0275cmp=i.Xpm({type:$,selectors:[["game-dialog"]],hostVars:2,hostBindings:function(t,r){2&t&&i.ekj("dialog",r.isDialog)},standalone:!0,features:[i.qOj,i.jDz],decls:6,vars:6,consts:[["mat-dialog-close",""],["mat-dialog-close","",3,"click"]],template:function(t,r){1&t&&(i.TgZ(0,"button",0),i._uU(1),i.ALo(2,"translate"),i.qZA(),i.TgZ(3,"button",1),i.NdJ("click",function(){return r.finish()}),i._uU(4),i.ALo(5,"translate"),i.qZA()),2&t&&(i.xp6(1),i.hij(" ",i.lcZ(2,2,"GamePage.GameDialog.Button.Continue"),"\n"),i.xp6(3),i.hij(" ",i.lcZ(5,4,"GamePage.GameDialog.Button.Finish"),"\n"))},dependencies:[O.Is,O.ZT,M.aw,M.X$,ee.r],styles:["[_nghost-%COMP%]{width:450px}.body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:30px}"],changeDetection:0})}class Q extends te.G{router;gameService;isDialog=!0;constructor(e,t){super(),this.router=e,this.gameService=t}ngOnInit(){super.ngOnInit(),this.self.afterOpened().pipe((0,f.R)(this.destroyer$)).subscribe(()=>{this.gameService.pause(),this.audioService.gameOver.replay()})}finish(){this.audioService.routing.replay(),this.router.navigateByUrl("/menu")}static \u0275fac=function(t){return new(t||Q)(i.Y36(ie.F0),i.Y36(_))};static \u0275cmp=i.Xpm({type:Q,selectors:[["game-over-dialog"]],hostVars:2,hostBindings:function(t,r){2&t&&i.ekj("dialog",r.isDialog)},standalone:!0,features:[i.qOj,i.jDz],decls:9,vars:9,consts:[[1,"title"],["mat-dialog-close","",3,"click"]],template:function(t,r){1&t&&(i.TgZ(0,"div",0),i._uU(1),i.ALo(2,"translate"),i.qZA(),i.TgZ(3,"button",1),i.NdJ("click",function(){return r.gameService.restart()}),i._uU(4),i.ALo(5,"translate"),i.qZA(),i.TgZ(6,"button",1),i.NdJ("click",function(){return r.finish()}),i._uU(7),i.ALo(8,"translate"),i.qZA()),2&t&&(i.xp6(1),i.Oqu(i.lcZ(2,3,"GamePage.GameOverDialog.Title")),i.xp6(3),i.hij(" ",i.lcZ(5,5,"GamePage.GameOverDialog.Button.Restart"),"\n"),i.xp6(3),i.hij(" ",i.lcZ(8,7,"GamePage.GameOverDialog.Button.Finish"),"\n"))},dependencies:[O.Is,O.ZT,M.aw,M.X$,ee.r],styles:["[_nghost-%COMP%]{width:450px}.body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:30px}"],changeDetection:0})}class q extends te.G{router;gameService;isDialog=!0;constructor(e,t){super(),this.router=e,this.gameService=t}ngOnInit(){super.ngOnInit(),this.self.afterOpened().pipe((0,f.R)(this.destroyer$)).subscribe(()=>{this.gameService.pause(),this.audioService.victory.replay()})}top(){this.audioService.routing.replay(),this.router.navigateByUrl("/top")}static \u0275fac=function(t){return new(t||q)(i.Y36(ie.F0),i.Y36(_))};static \u0275cmp=i.Xpm({type:q,selectors:[["victory-dialog"]],hostVars:2,hostBindings:function(t,r){2&t&&i.ekj("dialog",r.isDialog)},standalone:!0,features:[i.qOj,i.jDz],decls:6,vars:6,consts:[[1,"title"],["mat-dialog-close","",3,"click"]],template:function(t,r){1&t&&(i.TgZ(0,"div",0),i._uU(1),i.ALo(2,"translate"),i.qZA(),i.TgZ(3,"button",1),i.NdJ("click",function(){return r.top()}),i._uU(4),i.ALo(5,"translate"),i.qZA()),2&t&&(i.xp6(1),i.Oqu(i.lcZ(2,2,"GamePage.VictoryDialog.Title")),i.xp6(3),i.hij(" ",i.lcZ(5,4,"GamePage.VictoryDialog.Button.Top"),"\n"))},dependencies:[O.Is,O.ZT,M.aw,M.X$,ee.r],styles:["[_nghost-%COMP%]{width:450px}"],changeDetection:0})}var oi=l(3364),xe=l(6033);class J extends oi.g{elementRef;cdr;matDialog;gameService;heroService;bossService;heroName;lives=0;isShieldActivated=!1;isPunchActivated=!1;isLightningActivated=!1;hasBoss=!1;bossLifePct=0;score=0;constructor(e,t,r,n,a,o){super(),this.elementRef=e,this.cdr=t,this.matDialog=r,this.gameService=n,this.heroService=a,this.bossService=o,this.heroName=a.name}ngOnInit(){this.heroService.lives$.pipe((0,f.R)(this.destroyer$)).subscribe(e=>{this.lives=e,this.cdr.detectChanges(),e||this.matDialog.open(Q,{disableClose:!0})}),this.heroService.isShieldActivated$.pipe((0,f.R)(this.destroyer$)).subscribe(e=>{this.isShieldActivated=e,this.cdr.detectChanges()}),this.heroService.isPunchActivated$.pipe((0,f.R)(this.destroyer$)).subscribe(e=>{this.isPunchActivated=e,this.cdr.detectChanges()}),this.heroService.isLightningActivated$.pipe((0,f.R)(this.destroyer$)).subscribe(e=>{this.isLightningActivated=e,this.cdr.detectChanges()}),this.bossService.hasBoss$.pipe((0,f.R)(this.destroyer$)).subscribe(e=>{this.hasBoss=e,this.cdr.detectChanges()}),this.bossService.livesPct$.pipe((0,f.R)(this.destroyer$)).subscribe(e=>{if(this.bossLifePct=e,this.cdr.detectChanges(),!e){const t=localStorage.getItem(xe.y.Top),r=null!==t?JSON.parse(t):[],n=ft(r.concat({name:this.heroService.name,score:this.heroService.score}),10).sort((a,o)=>o.score-a.score);localStorage.setItem(xe.y.Top,JSON.stringify(n)),this.matDialog.open(q,{disableClose:!0})}}),this.heroService.score$.pipe((0,f.R)(this.destroyer$)).subscribe(e=>{this.score=e,this.cdr.detectChanges()})}ngAfterViewInit(){this.gameService.start(this.elementRef.nativeElement)}ngOnDestroy(){this.gameService.finish(),super.ngOnDestroy()}openGameDialog(){this.matDialog.openDialogs.length||this.matDialog.open($)}static \u0275fac=function(t){return new(t||J)(i.Y36(i.SBq),i.Y36(i.sBO),i.Y36(O.uw),i.Y36(_),i.Y36(Y.e),i.Y36(C))};static \u0275cmp=i.Xpm({type:J,selectors:[["game-page"]],hostBindings:function(t,r){1&t&&i.NdJ("keydown.esc",function(){return r.openGameDialog()},!1,i.evT)},standalone:!0,features:[i.qOj,i.jDz],decls:1,vars:8,consts:[[3,"lives","isShieldActivated","isPunchActivated","isLightningActivated","heroName","hasBoss","bossLifePct","score"]],template:function(t,r){1&t&&i._UZ(0,"bar",0),2&t&&i.Q6J("lives",r.lives)("isShieldActivated",r.isShieldActivated)("isPunchActivated",r.isPunchActivated)("isLightningActivated",r.isLightningActivated)("heroName",r.heroName)("hasBoss",r.hasBoss)("bossLifePct",r.bossLifePct)("score",r.score)},dependencies:[V],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-direction:column;width:100%;height:100%;cursor:none}bar[_ngcontent-%COMP%]{position:absolute}"],changeDetection:0})}}}]);